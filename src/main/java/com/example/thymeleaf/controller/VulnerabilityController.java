package com.example.thymeleaf.controller;

import org.springframework.web.bind.annotation.*;
import java.sql.*;
import java.io.*;

@RestController
@RequestMapping("/api/debug")
public class VulnerabilityController {

    // Vulnerability 1: SQL Injection
    @GetMapping("/student-search")
    public String getStudentData(@RequestParam String name) throws Exception {
        Connection conn = DriverManager.getConnection("jdbc:h2:mem:testdb", "sa", "");
        Statement st = conn.createStatement();
        String query = "SELECT * FROM students WHERE name = '" + name + "'";
        ResultSet rs = st.executeQuery(query);
        return "Executed query: " + query;
    }

    // Vulnerability 2: Command Injection
    @GetMapping("/ping")
    public String pingHost(@RequestParam String host) throws Exception {
        Process p = Runtime.getRuntime().exec("ping -c 1 " + host);
        BufferedReader input = new BufferedReader(new InputStreamReader(p.getInputStream()));
        return "Ping result for: " + host;
    }
}